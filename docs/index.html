<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Michaël Benesty" />


<title>Zonage des décisions - IA et Droit</title>

<script src="site_libs/jquery-1.12.4/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/htmlwidgets-0.9/htmlwidgets.js"></script>
<script src="site_libs/datatables-binding-0.2/datatables.js"></script>
<link href="site_libs/dt-core-1.10.12/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="site_libs/dt-core-1.10.12/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="site_libs/dt-core-1.10.12/js/jquery.dataTables.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
div.sourceCode {
  overflow-x: visible;
}
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">IA & Droit</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Baseline</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Zonage des décisions - IA et Droit</h1>
<h4 class="author"><em>Michaël Benesty</em></h4>
<h4 class="date"><em>13 décembre 2017</em></h4>

</div>


<p>L’objet du projet <a href="http://openlaw.fr/travaux/communs-numeriques/ia-droit-datasets-dapprentissage">IA &amp; Droit</a> porté par l’association <a href="http://openlaw.fr/">Open Law</a> est de créer un jeu de données qui permette de zoner les décisions de justice des Cours d’appel Françaises. Le présent document est une illustration d’une baseline de résultat pour ce jeu de données.</p>
<p>La tâche consiste à qualifier chaque paragraphe d’une décision de justice selon un <a href="https://github.com/pommedeterresautee/iaetdroit/releases">plan prédéfini</a> établie par les membres d’Open Law et la Cour de cassation.</p>
<p>Pour rappel le dépot des données et du code source du projet est <a href="https://github.com/pommedeterresautee/iaetdroit">ici</a>.<br />
En particulier, les données brutes et déjà parsées et sérialisées au format CSV sont <a href="https://github.com/pommedeterresautee/iaetdroit/releases">ici</a>.</p>
<p>Pour cet exercice, il n’y a pas eu de recherche des hyper-paramètres qui pourraient être facilement améliorés.<br />
Il est su de l’auteur de ce code que de simples modifications de ce code source (augmentation des epoch, des ngrams, etc.) permet de gagner de 1 à plusieurs points sur chaque tâche de classification.<br />
Il est su de l’auteur de ce code que de ne pas différencier test set et dev set, c’est foncièrement mal.<br />
C’est la raison pour laquelle il est important de <strong>prendre les présents résultats comme indicatifs</strong> de ce qui peut être fait.</p>
<p>L’approche choisie est une classification multiclass avec <a href="https://github.com/pommedeterresautee/fastrtext/"><code>fastrtext</code></a>.<br />
Les prédiction des types de chaque paragraphe (micro et macro) sont séparées de la prédiction de la partie concernée.</p>
<div id="pre-traitements" class="section level1">
<h1><span class="header-section-number">1</span> Pré-traitements</h1>
<div id="chargement-des-librairies" class="section level2">
<h2><span class="header-section-number">1.1</span> Chargement des librairies</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(data.table)
<span class="kw">library</span>(DT)
<span class="kw">library</span>(fastrtext)
<span class="kw">library</span>(stringi)
<span class="kw">library</span>(assertthat)
<span class="kw">library</span>(ggplot2)
<span class="kw">set.seed</span>(<span class="dv">123</span>)</code></pre></div>
</div>
<div id="lecture-des-donnees" class="section level2">
<h2><span class="header-section-number">1.2</span> Lecture des données</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="dt">input =</span> <span class="st">&quot;./annotations-clean.csv&quot;</span>, <span class="dt">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>)
<span class="kw">print</span>(<span class="kw">head</span>(dt))</code></pre></div>
<pre><code>##    line_num types types_macro annotation_difficulty
## 1:        1   n_a      Entete             Difficile
## 2:        2   n_a      Entete             Difficile
## 3:        3   n_a      Entete             Difficile
## 4:        4   n_a      Entete             Difficile
## 5:        5   n_a      Entete             Difficile
## 6:        6   n_a      Entete             Difficile
##                          text      dir                     file
## 1: COUR D&#39;APPEL DE VERSAILLES lot_0037 JURITEXT000033216500.txt
## 2:             Code nac : 53B lot_0037 JURITEXT000033216500.txt
## 3:                16e chambre lot_0037 JURITEXT000033216500.txt
## 4:                   ARRET No lot_0037 JURITEXT000033216500.txt
## 5:             CONTRADICTOIRE lot_0037 JURITEXT000033216500.txt
## 6:       DU 21 SEPTEMBRE 2016 lot_0037 JURITEXT000033216500.txt</code></pre>
<p>Il y a <strong>38017</strong> paragraphes dans le jeu de données.</p>
</div>
<div id="retrait-des-paragraphes-doublons" class="section level2">
<h2><span class="header-section-number">1.3</span> Retrait des paragraphes doublons</h2>
<p>Certains paragraphes sont doublement annotés pour calculer l’inter-agreement.<br />
Ils sont retirés.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt &lt;-<span class="st"> </span><span class="kw">local</span>({
  duplicated_files &lt;-<span class="st"> </span>dt[,.N,.(file, dir)][, .(<span class="dt">duplicated =</span> <span class="kw">duplicated</span>(file), file, dir)][duplicated <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>]
  dt_with_duplicated_info &lt;-<span class="st"> </span><span class="kw">merge</span>(dt, duplicated_files, <span class="dt">all.x =</span> <span class="ot">TRUE</span>)
  dt_with_duplicated_info[<span class="kw">is.na</span>(duplicated)]
})</code></pre></div>
</div>
<div id="comptage-des-types" class="section level2">
<h2><span class="header-section-number">1.4</span> Comptage des types</h2>
<p>Ce comptage est fait avant le retrait de certaines catégories et/ou compression de plusieurs types en 1.<br />
Il s’agit de donner un aperçu de la répartition des données brutes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">datatable</span>(dt[, .(<span class="dt">nb_mots_moyen =</span> <span class="kw">round</span>(<span class="kw">mean</span>(<span class="kw">stri_count_words</span>(text))), <span class="dt">nb_decisions =</span> .N), types][, <span class="st">`</span><span class="dt">%</span><span class="st">`</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>nb_decisions <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(nb_decisions), <span class="dv">2</span>)])</code></pre></div>
<div id="htmlwidget-49c968e2f00b87e48d74" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-49c968e2f00b87e48d74">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54"],["n_a","References_decision_attaquee","Entete_appelant","Entete_avocat","Entete_intime","Entete_composition_de_la_cour","Faits_et_procedure","Moyens_et_pretentions_appelant","Moyens_et_pretentions_intime","Motif-1","Motif-1 Motif-appelant Motif-1_pretentions_appelant Motif-juge","Motif-1_texte Motif-1 Motif-regle_de_droit Motif-juge","Motif-2","Motif-3","Motif-3 Motif-faits Motif-3_faits Motif-juge","Motif-3 Motif-3_texte Motif-regle_de_droit Motif-juge","Dispositif-1","Dispositif-2","Dispositif-3","Dispositif-demandes_accessoires","Motif-appelant Motif-2 Motif-2_pretentions_appelant Motif-juge","Motif-2 Motif-regle_de_droit Motif-2_texte Motif-juge","Motif-demandes_accessoires","Motif-2 Motif-2_faits Motif-faits Motif-juge","Motif-3 Motif-intime Motif-3_pretentions_intime Motif-juge","Motif-1 Motif-1_faits Motif-faits Motif-juge","Dispositif-2 Dispositif-1","Motif-3 Motif-3_pretentions_appelant Motif-appelant Motif-juge","Entete_appelant Entete_avocat","Entete_intime Entete_avocat","Motif-1 Motif-1_pretentions_intime Motif-intime Motif-juge","Dispositif-2 Dispositif-3 Dispositif-1","Motif-2 Motif-intime Motif-2_pretentions_intime Motif-juge","Dispositif-2 Dispositif-3","Dispositif-3 Dispositif-1","Dispositif-2 Dispositif-demandes_accessoires Dispositif-1","Dispositif-2 Dispositif-demandes_accessoires","Motif-demandes_accessoires Motif-1","Dispositif-demandes_accessoires Dispositif-1","Motif-intime Motif-faits Motif-3_faits Motif-3 Motif-3_pretentions_intime Motif-juge","Dispositif-2 Motif-1","Motif-2 Dispositif-1","Moyens_et_pretentions_intime Entete_avocat","Motif-intime Moyens_et_pretentions_intime Motif-3 Motif-3_pretentions_intime Motif-juge","Moyens_et_pretentions_appelant ","Moyens_et_pretentions_appelant Entete_avocat","Motif-appelant Motif-faits Motif-3_faits Motif-3 Motif-3_pretentions_appelant Motif-juge","Motif-regle_de_droit Motif-2_faits Motif-2_texte Motif-2 Motif-faits Motif-juge","Dispositif-demandes_accessoires Dispositif-3","Motif-3_texte Motif-regle_de_droit Motif-appelant Motif-3 Motif-3_pretentions_appelant Motif-juge","Motif-1_texte Motif-regle_de_droit Motif-1 Motif-2_faits Motif-faits Motif-juge","Faits_et_procedure Moyens_et_pretentions_appelant","Dispositif-demandes_accessoires Dispositif-3 Dispositif-1","Entete_appelant References_decision_attaquee"],[10,24,6,20,7,15,39,46,42,49,60,53,40,37,65,50,19,23,25,19,44,55,24,55,55,60,14,53,32,35,56,24,49,26,37,142,109,93,62,45,5,6,117,25,8,52,72,75,45,62,141,90,77,16],[7748,384,1711,1031,1959,1897,3680,2023,1902,1963,282,417,960,1329,378,185,917,219,280,672,112,178,541,333,64,825,51,77,82,101,185,89,89,44,7,1,3,3,2,1,1,2,1,1,1,1,2,1,3,1,1,2,1,1],[23.66,1.17,5.23,3.15,5.98,5.79,11.24,6.18,5.81,5.99,0.86,1.27,2.93,4.06,1.15,0.56,2.8,0.67,0.86,2.05,0.34,0.54,1.65,1.02,0.2,2.52,0.16,0.24,0.25,0.31,0.56,0.27,0.27,0.13,0.02,0,0.01,0.01,0.01,0,0,0.01,0,0,0,0,0.01,0,0.01,0,0,0.01,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>types<\/th>\n      <th>nb_mots_moyen<\/th>\n      <th>nb_decisions<\/th>\n      <th>%<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="repartition-de-la-difficulte-dannotation" class="section level2">
<h2><span class="header-section-number">1.5</span> Répartition de la difficulté d’annotation</h2>
<p>Les annotateurs ont noté la difficulté d’annoter chaque décision.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">datatable</span>(dt[, .(<span class="dt">nb_paragraphes =</span> .N), annotation_difficulty][, <span class="st">`</span><span class="dt">%</span><span class="st">`</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>nb_paragraphes <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(nb_paragraphes), <span class="dv">2</span>)])</code></pre></div>
<div id="htmlwidget-f474ad921ae63e0a53f4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f474ad921ae63e0a53f4">{"x":{"filter":"none","data":[["1","2","3","4"],["Moyen","Facile","Difficile","n_a"],[12101,11751,8242,650],[36.96,35.89,25.17,1.99]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>annotation_difficulty<\/th>\n      <th>nb_paragraphes<\/th>\n      <th>%<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Les décisions jugées difficiles à annoter sont conservées dans le jeu de données.<br />
Le retrait de ces décisions ne change pas de façon significative les résultats.</p>
</div>
<div id="retrait-de-certaines-categories" class="section level2">
<h2><span class="header-section-number">1.6</span> Retrait de certaines catégories</h2>
<p>Certains types sont regroupés.<br />
Les paragraphes typés <code>n_a</code> sont conservés.<br />
Leur retrait améliore considérablement la qualité des prédictions.<br />
Il est possible que nombre de paragraphes en <code>n_a</code> ne devrait pas l’être.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># remove paragraph type position</span>
dt[, types_clean_micro <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">stri_replace_all_regex</span>(types, <span class="st">&quot;-</span><span class="ch">\\</span><span class="st">d+&quot;</span>, <span class="st">&quot;&quot;</span>)]

<span class="co"># remove double labels due to numbers</span>
make_unique_labels &lt;-<span class="st"> </span><span class="cf">function</span>(label) {
  <span class="kw">paste</span>(<span class="kw">sort</span>(<span class="kw">unique</span>(<span class="kw">unlist</span>(<span class="kw">stri_split_fixed</span>(label, <span class="dt">pattern =</span> <span class="st">&quot; &quot;</span>)))), <span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>)
}

dt[, types_clean_micro <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">sapply</span>(types_clean_micro, make_unique_labels)]

<span class="co"># rationalizing motifs and dispositifs</span>
dt[, types_clean_micro <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">stri_detect_regex</span>(types_clean_micro, <span class="st">&quot;^Motif&quot;</span>), <span class="kw">ifelse</span>(<span class="kw">stri_detect_fixed</span>(types_clean_micro, <span class="st">&quot;Motif_texte&quot;</span>), <span class="st">&quot;Motif_texte&quot;</span>, <span class="st">&quot;Motif&quot;</span>), types_clean_micro)]
dt[types_clean_micro <span class="op">==</span><span class="st"> &quot;Dispositif-demandes_accessoires&quot;</span>, types_clean_micro <span class="op">:</span><span class="er">=</span><span class="st"> &quot;Dispositif_demandes_accessoires&quot;</span>]
dt[types_clean_micro <span class="op">==</span><span class="st"> &quot;Dispositif Dispositif-demandes_accessoires&quot;</span>, types_clean_micro <span class="op">:</span><span class="er">=</span><span class="st"> &quot;Dispositif_demandes_accessoires&quot;</span>]
dt[types_clean_micro <span class="op">==</span><span class="st"> &quot;Contenu_decision_attaquee Expose_litige&quot;</span>, types_clean_micro <span class="op">:</span><span class="er">=</span><span class="st"> &quot;Contenu_decision_attaquee_Expose_litige&quot;</span>]
dt[types_clean_micro <span class="op">==</span><span class="st"> &quot;Entete_appelant Entete_avocat&quot;</span>, types_clean_micro <span class="op">:</span><span class="er">=</span><span class="st"> &quot;Entete_appelant_avec_avocat&quot;</span>]
dt[types_clean_micro <span class="op">==</span><span class="st"> &quot;Entete_avocat Entete_intime&quot;</span>, types_clean_micro <span class="op">:</span><span class="er">=</span><span class="st"> &quot;Entete_intime_avec_avocat&quot;</span>]
dt[, types_clean_micro <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">stri_replace_all_regex</span>(types_clean_micro, <span class="st">&quot;_intime|_appelant&quot;</span>, <span class="st">&quot;&quot;</span>)]

dt[, position <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">seq</span>(types_clean_micro)) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(types_clean_micro), file]

dt[, intime <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">stri_detect_fixed</span>(types, <span class="st">&quot;_intime&quot;</span>)]
dt[, appelant <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">stri_detect_fixed</span>(types, <span class="st">&quot;_appelant&quot;</span>)]

<span class="co"># check that no paragraph are related to both types.</span>
<span class="kw">stopifnot</span>(dt[, <span class="kw">sum</span>(intime <span class="op">&amp;</span><span class="st"> </span>appelant)] <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)

dt[, side <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ifelse</span>(intime <span class="op">|</span><span class="st"> </span>appelant, <span class="kw">ifelse</span>(appelant, <span class="st">&quot;appelant&quot;</span>, <span class="st">&quot;intime&quot;</span>), <span class="st">&quot;aucun&quot;</span>)]

<span class="co"># Extract the first 20% and the last 20% of each decision</span>
dt &lt;-<span class="st"> </span><span class="kw">local</span>({
  intro &lt;-<span class="st"> </span>dt[position <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.2</span>, .(<span class="dt">intro =</span> <span class="kw">paste</span>(text, <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)), file]
  <span class="kw">merge</span>(dt, intro, <span class="dt">by =</span> <span class="st">&quot;file&quot;</span>)
})</code></pre></div>
</div>
<div id="preparation-des-donnees" class="section level2">
<h2><span class="header-section-number">1.7</span> Préparation des données</h2>
<p>La transformation des paragraphes pour l’apprentissage consiste essentiellement à ajouter les paragraphes qui précèdent et suivent sous forme de contexte.<br />
Présentement, les 3 paragraphes précédents et suivant sont ajoutés. Pour permettre au modèle de les distinguer du paragraphe à prédire, un préfixe est ajouté à chaque mot du contexte. Cette méthode augmente les résultats de plus de 10 points en fonction des tâches.</p>
<p>L’introduction de chaque décision (dans notre cas les 20 premiers % de chaque décision) renseigne en général sur la nature des parties et sa thématique, pour cette raison elle est aussi ajoutée au contexte de chaque paragraphe.</p>
<p>L’ajout de la position du paragraphe dans la décision (par tranche de 10%) ne semble pas aider la prédiction lorsque l’introduction est en contexte mais produit un effet lorsque l’introduction n’est pas ajoutée au contexte (+1/+2 points selon les taches).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">add_prefix &lt;-<span class="st"> </span><span class="cf">function</span>(prefix, labels) {
  add_prefix_item &lt;-<span class="st"> </span><span class="cf">function</span>(label, prefix) {
    s &lt;-<span class="st"> </span><span class="kw">stri_extract_all_boundaries</span>(label, <span class="dt">simplify =</span> <span class="ot">TRUE</span>)
    <span class="kw">paste0</span>(prefix, s, <span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>)
  }
  
  <span class="kw">sapply</span>(labels, <span class="dt">FUN =</span> add_prefix_item, <span class="dt">prefix =</span> prefix, <span class="dt">USE.NAMES =</span> <span class="ot">FALSE</span>)
}

swipe_features &lt;-<span class="st"> </span><span class="cf">function</span>(file, text, nbr) {
  <span class="cf">if</span> (nbr <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {
    p &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;previous_&quot;</span>, nbr, <span class="st">&quot;_&quot;</span>)
    r &lt;-<span class="st"> </span><span class="kw">add_prefix</span>(p, <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;&quot;</span>, nbr), <span class="kw">head</span>(text, <span class="op">-</span>nbr)))
    f &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;&quot;</span>, nbr), <span class="kw">head</span>(file, <span class="op">-</span>nbr)) <span class="op">==</span><span class="st"> </span>file
    <span class="kw">ifelse</span>(f, r, <span class="st">&quot;&quot;</span>)
  } <span class="cf">else</span> {
    nbr &lt;-<span class="st"> </span><span class="kw">abs</span>(nbr)
    p &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;next_&quot;</span>, nbr, <span class="st">&quot;_&quot;</span>)
    r &lt;-<span class="st"> </span><span class="kw">add_prefix</span>(p, <span class="kw">c</span>(<span class="kw">tail</span>(text, <span class="op">-</span>nbr), <span class="kw">rep</span>(<span class="st">&quot;&quot;</span>, nbr)))
    f &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">tail</span>(file, <span class="op">-</span>nbr), <span class="kw">rep</span>(<span class="st">&quot;&quot;</span>, nbr)) <span class="op">==</span><span class="st"> </span>file
    <span class="kw">ifelse</span>(f, r, <span class="st">&quot;&quot;</span>)
  }
}

dt[, text <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">stri_replace_all_regex</span>(<span class="kw">tolower</span>(text), <span class="dt">pattern =</span> <span class="st">&quot;[:punct:]&quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot; &quot;</span>)]
dt[, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span>(<span class="dt">features_without_label =</span> <span class="kw">paste</span>(<span class="kw">swipe_features</span>(file, text, <span class="dv">3</span>), <span class="kw">swipe_features</span>(file, text, <span class="dv">2</span>), <span class="kw">swipe_features</span>(file, text, <span class="dv">1</span>), text, <span class="kw">swipe_features</span>(file, text, <span class="op">-</span><span class="dv">1</span>), <span class="kw">swipe_features</span>(file, text, <span class="op">-</span><span class="dv">2</span>), <span class="kw">swipe_features</span>(file, text, <span class="op">-</span><span class="dv">3</span>)), <span class="dt">features_intro =</span> <span class="kw">add_prefix</span>(<span class="st">&quot;intro_&quot;</span>, intro), <span class="dt">features_position =</span> <span class="kw">paste0</span>(<span class="st">&quot;position_paragraphe_&quot;</span>, <span class="dv">10</span> <span class="op">*</span><span class="st"> </span><span class="kw">round</span>(position, <span class="dv">1</span>)))]

train_rows &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.8</span> <span class="op">*</span><span class="st"> </span><span class="kw">nrow</span>(dt))
test_rows &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">max</span>(train_rows) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="kw">nrow</span>(dt))</code></pre></div>
<div id="affichage-dun-exemple-de-paragraphe." class="section level3">
<h3><span class="header-section-number">1.7.1</span> Affichage d’un exemple de paragraphe.</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Original text, paragraphs 1 to 7</span>
<span class="kw">print</span>(dt[<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, text])</code></pre></div>
<pre><code>## [1] &quot;ch  civile a&quot;                                                                                                                                                                 
## [2] &quot;arret no&quot;                                                                                                                                                                     
## [3] &quot;du 13 janvier 2016&quot;                                                                                                                                                           
## [4] &quot;r  g   14  00998 r&quot;                                                                                                                                                           
## [5] &quot;décision déférée à la cour   jugement au fond  origine tribunal de grande instance de bastia  décision attaquée en date du 01 décembre 2014  enregistrée sous le no 13  01439&quot;
## [6] &quot;x   &quot;                                                                                                                                                                         
## [7] &quot;c &quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Paragraph 4 with its context (as seen by fastrtext)</span>
<span class="kw">print</span>(dt[<span class="dv">4</span>, features_without_label])</code></pre></div>
<pre><code>## [1] &quot;previous_3_ch   previous_3_civile  previous_3_a previous_2_arret  previous_2_no previous_1_du  previous_1_13  previous_1_janvier  previous_1_2016 r  g   14  00998 r next_1_décision  next_1_déférée  next_1_à  next_1_la  next_1_cour    next_1_jugement  next_1_au  next_1_fond   next_1_origine  next_1_tribunal  next_1_de  next_1_grande  next_1_instance  next_1_de  next_1_bastia   next_1_décision  next_1_attaquée  next_1_en  next_1_date  next_1_du  next_1_01  next_1_décembre  next_1_2014   next_1_enregistrée  next_1_sous  next_1_le  next_1_no  next_1_13   next_1_01439 next_2_x    next_3_c &quot;</code></pre>
</div>
</div>
</div>
<div id="apprentissages" class="section level1">
<h1><span class="header-section-number">2</span> Apprentissages</h1>
<div id="typage-des-paragraphes" class="section level2">
<h2><span class="header-section-number">2.1</span> Typage des paragraphes</h2>
<p>On essaye ci-dessous de deviner la nature du paragraphe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">local</span>({
  dt[, features_with_type_label <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste</span>(<span class="kw">add_prefix</span>(<span class="st">&quot;__label__&quot;</span>, types_clean_micro), features_without_label, features_intro, features_position)]
  temp_file_train &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
  temp_file_model &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
  <span class="kw">writeLines</span>(dt[train_rows, <span class="kw">sample</span>(features_with_type_label)], <span class="dt">con =</span> temp_file_train)
  <span class="kw">execute</span>(<span class="dt">commands =</span> <span class="kw">c</span>(<span class="st">&quot;supervised&quot;</span>, <span class="st">&quot;-input&quot;</span>, temp_file_train, <span class="st">&quot;-output&quot;</span>, temp_file_model, <span class="st">&quot;-dim&quot;</span>, <span class="dv">10</span>, <span class="st">&quot;-lr&quot;</span>, <span class="dv">1</span>, <span class="st">&quot;-epoch&quot;</span>, <span class="dv">20</span>, <span class="st">&quot;-wordNgrams&quot;</span>, <span class="dv">2</span>, <span class="st">&quot;-verbose&quot;</span>, <span class="dv">0</span>))
  model &lt;-<span class="st"> </span><span class="kw">load_model</span>(temp_file_model)
  predictions &lt;-<span class="st"> </span><span class="kw">predict</span>(model, <span class="dt">sentences =</span> dt[test_rows][, features_with_type_label], <span class="dt">simplify =</span> <span class="ot">TRUE</span>)
  predicted_labels &lt;-<span class="st"> </span><span class="kw">names</span>(predictions)
  <span class="kw">invisible</span>(<span class="kw">assert_that</span>(<span class="kw">length</span>(test_rows) <span class="op">==</span><span class="st"> </span><span class="kw">length</span>(predicted_labels)))
  dt[test_rows, predicted_labels <span class="op">:</span><span class="er">=</span><span class="st"> </span>predicted_labels]
  <span class="kw">local</span>({
    tab &lt;-<span class="st"> </span>dt[test_rows, .(<span class="dt">nb_mots_moyen =</span> <span class="kw">round</span>(<span class="kw">mean</span>(<span class="kw">stri_count_words</span>(text))), <span class="dt">nb_decisions =</span> .N, <span class="dt">accuracy =</span> <span class="kw">round</span>(<span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">mean</span>(predicted_labels <span class="op">==</span><span class="st"> </span>types_clean_micro), <span class="dv">2</span>)), types_clean_micro]
    <span class="kw">datatable</span>(tab)
  })
})</code></pre></div>
<pre><code>## add .bin extension to the path</code></pre>
<div id="htmlwidget-e3b1a3fea7b58b984a25" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e3b1a3fea7b58b984a25">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12"],["Motif","n_a","Dispositif","Dispositif_demandes_accessoires","References_decision_attaquee","Entete","Entete_avocat","Entete_composition_de_la_cour","Faits_et_procedure","Moyens_et_pretentions","Motif_texte","Entete_avec_avocat"],[53,8,20,20,23,6,21,15,38,42,59,24],[1366,1564,332,151,101,686,189,434,824,649,224,29],[94.58,84.78,70.18,81.46,71.29,88.34,91.01,82.49,77.79,88.91,41.96,44.83]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>types_clean_micro<\/th>\n      <th>nb_mots_moyen<\/th>\n      <th>nb_decisions<\/th>\n      <th>accuracy<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>En moyenne, le bon type est trouvé dans <strong>84.09%</strong> des <strong>6549</strong> paragraphes utilisés pour les tests.</p>
<p>Les erreurs se décomposent de la façon suivante :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">local</span>({
  errors_dt &lt;-<span class="st"> </span>dt[test_rows][types_clean_micro <span class="op">!=</span><span class="st"> </span>predicted_labels, .(<span class="dt">nb_erreurs =</span> .N), predicted_labels][, <span class="st">`</span><span class="dt">%</span><span class="st">`</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">round</span>(nb_erreurs <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(nb_erreurs), <span class="dv">4</span>)][<span class="kw">order</span>(<span class="op">-</span>nb_erreurs)]
  <span class="kw">datatable</span>(errors_dt)
})</code></pre></div>
<div id="htmlwidget-f6e6b0cb067ac237513b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f6e6b0cb067ac237513b">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12"],["n_a","Motif","Faits_et_procedure","Moyens_et_pretentions","Dispositif","Entete","Entete_composition_de_la_cour","Dispositif_demandes_accessoires","Entete_avocat","Motif_texte","Entete_avec_avocat","References_decision_attaquee"],[385,230,116,99,74,64,33,11,11,10,7,2],[36.95,22.07,11.13,9.5,7.1,6.14,3.17,1.06,1.06,0.96,0.67,0.19]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>predicted_labels<\/th>\n      <th>nb_erreurs<\/th>\n      <th>%<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="typage-macro" class="section level2">
<h2><span class="header-section-number">2.2</span> Typage macro</h2>
<p>Des tags macro sont présents dans le fichier.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">local</span>({
  dt[, features_with_type_macro <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste</span>(<span class="kw">add_prefix</span>(<span class="st">&quot;__label__&quot;</span>, types_macro), features_without_label, features_intro, features_position)]
  temp_file_train &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
  temp_file_model &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
  <span class="kw">writeLines</span>(dt[train_rows, <span class="kw">sample</span>(features_with_type_macro)], <span class="dt">con =</span> temp_file_train)
  <span class="kw">execute</span>(<span class="dt">commands =</span> <span class="kw">c</span>(<span class="st">&quot;supervised&quot;</span>, <span class="st">&quot;-input&quot;</span>, temp_file_train, <span class="st">&quot;-output&quot;</span>, temp_file_model, <span class="st">&quot;-dim&quot;</span>, <span class="dv">10</span>, <span class="st">&quot;-lr&quot;</span>, <span class="dv">1</span>, <span class="st">&quot;-epoch&quot;</span>, <span class="dv">20</span>, <span class="st">&quot;-wordNgrams&quot;</span>, <span class="dv">2</span>, <span class="st">&quot;-verbose&quot;</span>, <span class="dv">0</span>))
  model &lt;-<span class="st"> </span><span class="kw">load_model</span>(temp_file_model)
  predictions &lt;-<span class="st"> </span><span class="kw">predict</span>(model, <span class="dt">sentences =</span> dt[test_rows, features_with_type_macro], <span class="dt">simplify =</span> <span class="ot">TRUE</span>)
  <span class="kw">invisible</span>(<span class="kw">assert_that</span>(<span class="kw">length</span>(test_rows) <span class="op">==</span><span class="st"> </span><span class="kw">length</span>(predictions)))
  dt[test_rows, predicted_labels_macro <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">names</span>(predictions)]
  <span class="kw">datatable</span>(dt[test_rows, .(<span class="dt">nb_mots_moyen =</span> <span class="kw">round</span>(<span class="kw">mean</span>(<span class="kw">stri_count_words</span>(text))), <span class="dt">nb_decisions =</span> .N, <span class="dt">accuracy =</span> <span class="kw">round</span>(<span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">mean</span>(types_macro <span class="op">==</span><span class="st"> </span>predicted_labels_macro), <span class="dv">2</span>)), types_macro])
})</code></pre></div>
<pre><code>## add .bin extension to the path</code></pre>
<div id="htmlwidget-246a695e27233b7744db" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-246a695e27233b7744db">{"x":{"filter":"none","data":[["1","2","3","4"],["Motif_de_la_decision","Dispositif","Entete","Expose_litige"],[50,17,11,38],[1714,758,2513,1564],[96.56,89.58,96.74,93.35]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>types_macro<\/th>\n      <th>nb_mots_moyen<\/th>\n      <th>nb_decisions<\/th>\n      <th>accuracy<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>En moyenne, le bon type macro est trouvé dans <strong>95.05%</strong> des <strong>6549</strong> paragraphes utilisés pour les tests.</p>
<p>Les erreurs se décomposent de la façon suivante :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">local</span>({
  errors_dt &lt;-<span class="st"> </span>dt[test_rows][types_macro <span class="op">!=</span><span class="st"> </span>predicted_labels_macro, .(<span class="dt">nb_erreurs =</span> .N), predicted_labels_macro][, <span class="st">`</span><span class="dt">%</span><span class="st">`</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">round</span>(nb_erreurs <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(nb_erreurs), <span class="dv">4</span>)][<span class="kw">order</span>(<span class="op">-</span>nb_erreurs)]
  <span class="kw">datatable</span>(errors_dt)
})</code></pre></div>
<div id="htmlwidget-0b71cc1f8f3420c0e55f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0b71cc1f8f3420c0e55f">{"x":{"filter":"none","data":[["1","2","3","4"],["Expose_litige","Motif_de_la_decision","Entete","Dispositif"],[189,109,23,3],[58.33,33.64,7.1,0.93]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>predicted_labels_macro<\/th>\n      <th>nb_erreurs<\/th>\n      <th>%<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="partie-concernee-par-un-paragraphe" class="section level2">
<h2><span class="header-section-number">2.3</span> Partie concernée par un paragraphe</h2>
<p>On essaye de prédire qui est lié au paragraphe.<br />
Le retrait de l’introduction et de la position semble aider (+5 points sur appelant et intimé).<br />
Cela impliquerait un overfit ?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">local</span>({
  dt[, features_with_side_label <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste</span>(<span class="kw">add_prefix</span>(<span class="st">&quot;__label__&quot;</span>, side), features_without_label)]
  temp_file_train &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
  temp_file_model &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
  <span class="kw">writeLines</span>(dt[train_rows, <span class="kw">sample</span>(features_with_side_label)], <span class="dt">con =</span> temp_file_train)
  <span class="kw">execute</span>(<span class="dt">commands =</span> <span class="kw">c</span>(<span class="st">&quot;supervised&quot;</span>, <span class="st">&quot;-input&quot;</span>, temp_file_train, <span class="st">&quot;-output&quot;</span>, temp_file_model, <span class="st">&quot;-dim&quot;</span>, <span class="dv">10</span>, <span class="st">&quot;-lr&quot;</span>, <span class="dv">1</span>, <span class="st">&quot;-epoch&quot;</span>, <span class="dv">20</span>, <span class="st">&quot;-wordNgrams&quot;</span>, <span class="dv">2</span>, <span class="st">&quot;-verbose&quot;</span>, <span class="dv">0</span>))
  model &lt;-<span class="st"> </span><span class="kw">load_model</span>(temp_file_model)
  predictions &lt;-<span class="st"> </span><span class="kw">predict</span>(model, <span class="dt">sentences =</span> dt[test_rows, features_with_side_label], <span class="dt">simplify =</span> <span class="ot">TRUE</span>)
  <span class="kw">invisible</span>(<span class="kw">assert_that</span>(<span class="kw">length</span>(test_rows) <span class="op">==</span><span class="st"> </span><span class="kw">length</span>(predictions)))
  dt[test_rows, predicted_side <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">names</span>(predictions)]
  <span class="kw">datatable</span>(dt[test_rows, .(<span class="dt">nb_mots_moyen =</span> <span class="kw">round</span>(<span class="kw">mean</span>(<span class="kw">stri_count_words</span>(text))), <span class="dt">nb_decisions =</span> .N, <span class="dt">accuracy =</span> <span class="kw">round</span>(<span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">mean</span>(predicted_side <span class="op">==</span><span class="st"> </span>side), <span class="dv">2</span>)), side])
})</code></pre></div>
<pre><code>## add .bin extension to the path</code></pre>
<div id="htmlwidget-aa186246d072cfcfcb70" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-aa186246d072cfcfcb70">{"x":{"filter":"none","data":[["1","2","3"],["aucun","appelant","intime"],[29,30,24],[5058,756,735],[94.21,71.43,73.47]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>side<\/th>\n      <th>nb_mots_moyen<\/th>\n      <th>nb_decisions<\/th>\n      <th>accuracy<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>En moyenne, la partie concernée par un paragraphe est trouvée dans <strong>89.25%</strong> des <strong>6549</strong> paragraphes utilisés pour les tests.</p>
<p>Les erreurs se décomposent de la façon suivante :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">local</span>({
  errors_dt &lt;-<span class="st"> </span>dt[test_rows][side <span class="op">!=</span><span class="st"> </span>predicted_side, .(<span class="dt">nb_erreurs =</span> .N), predicted_side][, <span class="st">`</span><span class="dt">%</span><span class="st">`</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">round</span>(nb_erreurs <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(nb_erreurs), <span class="dv">4</span>)][<span class="kw">order</span>(<span class="op">-</span>nb_erreurs)]
  <span class="kw">datatable</span>(errors_dt)
})</code></pre></div>
<div id="htmlwidget-c1a1b5007938619c5a1c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c1a1b5007938619c5a1c">{"x":{"filter":"none","data":[["1","2","3"],["appelant","intime","aucun"],[296,222,186],[42.05,31.53,26.42]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>predicted_side<\/th>\n      <th>nb_erreurs<\/th>\n      <th>%<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
